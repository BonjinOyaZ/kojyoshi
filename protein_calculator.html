<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>必要タンパク質量 計算ツール</title>
    <style>
        body { font-family: sans-serif; line-height: 1.6; padding: 20px; max-width: 600px; margin: 0 auto; }
        h1, h2 { text-align: center; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input[type="number"], select { width: 100%; padding: 8px; box-sizing: border-box; }
        button { display: block; width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        #result { margin-top: 20px; padding: 15px; background-color: #f0f0f0; border: 1px solid #ddd; }
    </style>
</head>
<body>

    <h1>必要タンパク質量 計算ツール</h1>

    <div class="input-group">
        <label for="gender">性別:</label>
        <select id="gender" onchange="toggleFields()">
            <option value="female">女性</option>
            <option value="male">男性</option>
        </select>
    </div>

    <div id="female-fields">
        <div class="input-group">
            <label for="hip">ヒップ (cm):</label>
            <input type="number" id="hip" placeholder="お尻の一番太い部分">
        </div>
        <div class="input-group">
            <label for="waist-female">ウエスト (cm):</label>
            <input type="number" id="waist-female" placeholder="おへその周り">
        </div>
        <div class="input-group">
            <label for="height">身長 (cm):</label>
            <input type="number" id="height">
        </div>
    </div>

    <div id="male-fields" style="display: none;">
        <div class="input-group">
            <label for="waist-male">ウエスト (cm):</label>
            <input type="number" id="waist-male" placeholder="おへその周り">
        </div>
        <div class="input-group">
            <label for="wrist">手首まわり (cm):</label>
            <input type="number" id="wrist" placeholder="手首の骨の間">
        </div>
    </div>

    <div class="input-group">
        <label for="weight">体重 (kg):</label>
        <input type="number" id="weight">
    </div>

    <div class="input-group">
        <label for="activity-level">身体的活動レベル:</label>
        <select id="activity-level">
            <option value="1.1">座りがちな生活</option>
            <option value="1.3">軽い運動 (週1-2回)</option>
            <option value="1.5">中程度の運動 (週3-4回)</option>
            <option value="1.7">激しい運動 (週5回以上)</option>
        </select>
    </div>

    <button onclick="calculate()">計算する</button>

    <div id="result" style="display: none;">
        <h2>計算結果</h2>
        <p><strong>体脂肪率:</strong> <span id="body-fat-percentage"></span>%</p>
        <p><strong>除脂肪体重 (LBM):</strong> <span id="lbm"></span> kg</p>
        <p><strong>1日に必要なタンパク質量:</strong> <span id="protein-requirement"></span> g</p>
        <p><strong>1食あたりのタンパク質量の目安 (3食の場合):</strong> <span id="protein-per-meal"></span> g</p>
    </div>

    <script>
        const femaleConstants = {
            hip: { 115.5: 54.86, 117.0: 55.83, 118.0: 56.18, 119.5: 57.22, 120.5: 57.57, 122.0: 58.62, 123.0: 58.97, 124.5: 60.02, 125.5: 60.37, 127.0: 61.42, 128.5: 61.77, 129.5: 62.81, 131.0: 63.16, 132.0: 64.21, 133.5: 64.56, 134.5: 65.61, 136.0: 65.96, 137.0: 67.00, 138.5: 67.35, 139.5: 68.40, 141.0: 68.75, 142.0: 69.80, 143.5: 70.15, 145.0: 71.19, 146.0: 71.54, 147.5: 72.59, 148.5: 72.94, 150.0: 73.99, 151.0: 74.34, 152.5: 75.39 },
            waist: { 51.0: 14.22, 52.0: 14.40, 53.5: 14.93, 54.5: 15.11, 56.0: 15.64, 57.0: 15.82, 58.5: 16.35, 59.5: 16.53, 61.0: 17.06, 62.0: 17.24, 63.5: 17.78, 65.0: 17.96, 66.0: 18.49, 67.5: 18.67, 68.5: 19.20, 70.0: 19.38, 71.0: 19.91, 72.5: 20.27, 73.5: 20.62, 75.0: 20.80, 76.0: 21.33, 77.5: 21.51, 78.5: 22.04, 80.0: 22.22, 81.5: 22.75, 82.5: 22.93, 84.0: 23.46, 85.0: 23.64, 86.5: 24.18, 87.5: 24.36, 89.0: 24.89, 90.0: 25.07, 91.5: 25.60, 92.5: 25.78, 94.0: 26.31, 95.5: 26.49, 96.5: 27.02, 98.0: 27.20, 99.0: 27.73, 100.5: 27.91, 101.5: 28.44, 103.0: 28.62, 104.0: 29.15, 105.5: 29.33, 106.5: 29.87, 108.0: 30.05, 109.0: 30.58, 110.5: 30.76, 112.0: 31.29, 113.0: 31.47, 114.5: 32.00, 115.5: 32.18, 117.0: 32.71, 118.0: 32.89, 119.5: 33.42, 120.5: 33.60, 122.0: 34.13, 123.0: 34.31, 124.5: 34.84, 125.5: 35.02, 127.0: 35.56 },
            height: { 179.0: 42.82, 180.5: 43.28, 181.5: 43.43, 183.0: 43.89, 184.0: 44.04, 185.5: 44.50, 186.5: 44.65, 188.0: 45.11, 189.0: 45.26, 190.5: 45.72, 192.0: 45.87, 193.0: 46.32 }
        };

        const maleConstants = {
            wrist_5_to_6: { 56.5: [4,6,8,10,12,14,16,17,19,20,22,24,25,27,28,30,32,33,35,37,38,40,41,43,45,47,49,50,52,54], 59.0: [3,5,7,9,11,13,15,16,18,19,21,23,24,26,28,29,31,33,34,36,38,39,41,43,44,46,48,50,52], 61.5: [3,5,7,9,11,13,15,17,19,20,22,24,25,27,29,30,32,34,36,38,39,41,43,44,46,48,50], 63.5: [3,5,7,9,11,13,15,17,19,21,23,24,26,28,29,31,33,34,36,38,39,41,43,44,46,48], 66.0: [4,6,7,9,11,13,15,17,19,20,22,23,25,27,28,30,31,33,35,36,38,40,41,43,44], 68.0: [4,6,7,9,12,13,15,17,18,20,21,23,25,26,28,29,31,33,35,36,38,40,41,43], 70.5: [4,5,6,8,10,12,14,16,18,19,21,23,24,26,28,29,31,33,34,36,38,40,41,43], 72.5: [3,5,6,8,10,11,13,15,17,19,20,22,24,25,27,28,30,32,34,36,37,38,40,41], 75.0: [3,5,6,8,9,11,13,15,16,18,19,21,23,24,26,28,29,31,33,34,36,37,39,40], 77.0: [4,6,7,9,10,12,14,15,17,18,20,22,23,25,26,28,30,32,33,35,36,37,39], 79.5: [4,6,7,9,10,12,13,15,17,18,20,21,23,25,26,28,29,31,33,35,36,37], 81.5: [4,5,6,8,9,11,13,14,16,18,19,21,22,24,25,27,28,30,32,34,35,36], 84.0: [4,5,6,8,9,11,13,15,16,17,19,20,22,23,24,26,28,29,31,33,34,35], 86.0: [3,5,6,7,9,11,12,14,15,16,18,19,21,22,24,25,27,28,30,31,33,34], 88.5: [3,5,6,7,9,11,12,14,15,17,18,20,21,22,24,25,26,28,29,31,32,33], 90.5: [3,4,6,7,8,10,12,13,14,16,17,19,20,22,23,24,26,27,28,30,31,32], 93.0: [3,4,5,6,8,9,11,12,14,15,17,18,19,21,22,23,25,26,27,29,30,31], 95.5: [4,5,6,7,9,10,11,13,14,15,17,18,20,21,22,24,25,26,28,29,30], 97.5: [4,5,6,7,8,9,11,12,13,15,16,17,19,20,21,23,24,25,26,28,29,30], 100.0: [3,4,5,6,7,9,10,12,13,14,16,17,18,19,20,22,23,24,25,27,28,29], 102.0: [3,4,5,6,7,8,10,11,12,14,15,16,17,19,20,22,23,24,26,27,28], 104.5: [3,4,5,6,7,9,10,11,13,14,15,16,18,19,20,21,22,24,25,26,28], 106.5: [3,4,5,6,7,8,9,11,12,13,14,16,17,18,19,21,22,23,24,25,27], 109.0: [4,5,6,7,8,9,10,11,12,14,15,16,17,18,20,21,22,23,25,26,27], 111.0: [4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,23,24,25,26], 113.5: [3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,20,21,22,23,24,25], 115.5: [3,4,5,6,7,8,9,10,11,12,14,15,16,17,18,19,20,21,22,24,25], 118.0: [3,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24], 120.5: [4,5,6,7,7,8,10,11,12,13,14,15,16,17,18,19,20,22,23,24], 122.5: [4,5,6,7,7,8,9,11,12,13,14,15,16,17,18,19,20,21,22,23], 125.0: [4,5,6,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22], 127.0: [4,5,6,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22], 129.5: [4,5,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21], 131.5: [3,4,5,6,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21], 134.0: [3,4,5,6,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20], 136.0: [3,4,5,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] },
            waist_values: [57.0, 58.5, 60.0, 62.0, 65.0, 67.5, 70.0, 72.5, 75.0, 77.5, 80.0, 82.5, 85.0, 87.5, 90.0, 92.5, 95.5, 98.0, 100.5, 103.0, 105.5, 108.0, 110.5, 113.0, 115.5, 118.0, 120.5, 123.0, 125.5, 127.0]
        };

        function toggleFields() {
            const gender = document.getElementById('gender').value;
            if (gender === 'female') {
                document.getElementById('female-fields').style.display = 'block';
                document.getElementById('male-fields').style.display = 'none';
            } else {
                document.getElementById('female-fields').style.display = 'none';
                document.getElementById('male-fields').style.display = 'block';
            }
        }

        function findClosestKey(obj, value) {
            return Object.keys(obj).reduce((prev, curr) => 
                Math.abs(curr - value) < Math.abs(prev - value) ? curr : prev
            );
        }

        function calculate() {
            const gender = document.getElementById('gender').value;
            const weight = parseFloat(document.getElementById('weight').value);
            const activityLevel = parseFloat(document.getElementById('activity-level').value);

            if (isNaN(weight) || weight <= 0) {
                alert('有効な体重を入力してください。');
                return;
            }

            let bodyFatPercentage;

            if (gender === 'female') {
                const hip = parseFloat(document.getElementById('hip').value);
                const waist = parseFloat(document.getElementById('waist-female').value);
                const height = parseFloat(document.getElementById('height').value);

                if (isNaN(hip) || isNaN(waist) || isNaN(height) || hip <= 0 || waist <= 0 || height <= 0) {
                    alert('女性用のすべての項目（ヒップ、ウエスト、身長）に有効な数値を入力してください。');
                    return;
                }

                const constAKey = findClosestKey(femaleConstants.hip, hip);
                const constBKey = findClosestKey(femaleConstants.waist, waist);
                const constCKey = findClosestKey(femaleConstants.height, height);

                const constA = femaleConstants.hip[constAKey];
                const constB = femaleConstants.waist[constBKey];
                const constC = femaleConstants.height[constCKey];
                
                bodyFatPercentage = constA + constB - constC;

            } else { // male
                const waist = parseFloat(document.getElementById('waist-male').value);
                const wrist = parseFloat(document.getElementById('wrist').value);

                if (isNaN(waist) || isNaN(wrist) || waist <= 0 || wrist <= 0) {
                    alert('男性用のすべての項目（ウエスト、手首まわり）に有効な数値を入力してください。');
                    return;
                }
                
                // For simplicity, we'll use the first wrist category for now.
                // A more complex implementation could select the table based on wrist size.
                const waistWristDiff = waist - wrist;
                const weightKey = findClosestKey(maleConstants.wrist_5_to_6, weight);
                const closestWaistDiffValue = maleConstants.waist_values.reduce((prev, curr) => {
                    return (Math.abs(curr - waistWristDiff) < Math.abs(prev - waistWristDiff) ? curr : prev);
                });
                const waistIndex = maleConstants.waist_values.indexOf(closestWaistDiffValue);
                
                if(waistIndex === -1){
                    alert('ウエストの値が換算表の範囲外です。');
                    return;
                }

                bodyFatPercentage = maleConstants.wrist_5_to_6[weightKey][waistIndex];
            }

            if (bodyFatPercentage === undefined || bodyFatPercentage <= 0) {
                alert('体脂肪率を計算できませんでした。入力値を確認してください。');
                return;
            }

            const bodyFatMass = weight * (bodyFatPercentage / 100);
            const lbm = weight - bodyFatMass;
            const proteinRequirement = lbm * activityLevel;
            const proteinPerMeal = proteinRequirement / 3;

            document.getElementById('body-fat-percentage').textContent = bodyFatPercentage.toFixed(2);
            document.getElementById('lbm').textContent = lbm.toFixed(2);
            document.getElementById('protein-requirement').textContent = proteinRequirement.toFixed(2);
            document.getElementById('protein-per-meal').textContent = proteinPerMeal.toFixed(2);

            document.getElementById('result').style.display = 'block';
        }
    </script>

</body>
</html>
